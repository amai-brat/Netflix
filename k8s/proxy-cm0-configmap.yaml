apiVersion: v1
data:
  nginx.prod.conf: "worker_processes 4;\n\nevents { worker_connections 1024; }\n\nhttp {\n    sendfile on;\n    include       /etc/nginx/mime.types;\n    default_type  application/octet-stream;\n    \n    map $http_connection $connection_upgrade {\n        \"~*Upgrade\" $http_connection;\n        default keep-alive;\n    }\n\n    server {\n        gzip on;\n        listen 80;\n        server_name voltorka.ru s3.voltorka.ru;\n        \n        location / {\n            return 301 https://$host$request_uri;\n        }\n    }\n    \n    server {\n        gzip on;\n        server_name voltorka.ru;\n        listen                    443 ssl;\n        ssl_certificate           /root/ssl-keys/voltorka-bundle.txt;\n        ssl_certificate_key       /root/ssl-keys/voltorka-key.txt;\n        ssl_session_timeout       1d;\n        ssl_protocols             TLSv1.2 TLSv1.3;\n        ssl_prefer_server_ciphers off;\n        ssl_ciphers               ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384;\n        ssl_session_cache         shared:SSL:10m;\n        ssl_session_tickets       off;\n        ssl_stapling              off;\n\n        add_header X-Frame-Options DENY;\n        add_header X-Content-Type-Options nosniff;\n        \n        location / {\n            root   /usr/share/nginx/html;\n            index  index.html index.htm;\n            try_files $uri $uri/ /index.html;\n        }\n        \n        location /support/ {\n            proxy_pass         http://support-persistent-service:8080/;\n            proxy_set_header   Upgrade $http_upgrade;\n            proxy_set_header   Connection $connection_upgrade;\n            proxy_set_header   Host $host;\n            proxy_http_version 1.1;\n            proxy_buffering    off;\n            proxy_read_timeout 100s;\n            proxy_cache_bypass $http_upgrade;\n            proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;\n            proxy_set_header   X-Forwarded-Proto $scheme;\n        }\n\n        location /supporthub/ {\n            proxy_pass         http://support-service:8090/;\n            proxy_set_header   Upgrade $http_upgrade;\n            proxy_set_header   Connection $connection_upgrade;\n            proxy_set_header   Host $host;\n            proxy_http_version 1.1;\n            proxy_buffering    off;\n            proxy_read_timeout 100s;\n            proxy_cache_bypass $http_upgrade;\n            proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;\n            proxy_set_header   X-Forwarded-Proto $scheme;\n        }\n\n        location /subscription/ {\n            proxy_pass         http://subscription-service:3000/subscription/;\n        }\n\n        location /api/ {\n            proxy_pass         http://api:8080/;\n            proxy_set_header   Upgrade $http_upgrade;\n            proxy_set_header   Connection $connection_upgrade;\n            proxy_set_header   Host $host;\n            proxy_http_version 1.1;\n            proxy_buffering    off;\n            proxy_read_timeout 100s;\n            proxy_cache_bypass $http_upgrade;\n            proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;\n            proxy_set_header   X-Forwarded-Proto $scheme;\n            client_max_body_size 5G;\n        }\n    }\n\n    server {\n        server_name               s3.voltorka.ru;\n        listen                    443 ssl;\n        ssl_certificate           /root/ssl-keys/voltorka-s3-bundle.txt;\n        ssl_certificate_key       /root/ssl-keys/voltorka-s3-key.txt;\n        ssl_session_timeout       1d;\n        ssl_protocols             TLSv1.2 TLSv1.3;\n        ssl_prefer_server_ciphers off;\n        ssl_ciphers               ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384;\n        ssl_session_cache         shared:SSL:10m;\n        ssl_session_tickets       off;\n        ssl_stapling              off;\n\n        location / {\n            proxy_pass         http://minio:9000/;\n            proxy_set_header   Host $host;\n            proxy_set_header   X-Real-IP $remote_addr;\n            proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;\n            proxy_set_header   X-Forwarded-Proto $scheme;\n        }\n    }\n}\n"
kind: ConfigMap
metadata:
  annotations:
    use-subpath: "true"
  labels:
    io.kompose.service: proxy
  name: proxy-cm0
